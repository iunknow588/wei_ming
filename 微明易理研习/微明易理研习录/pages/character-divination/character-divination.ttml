<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="divination-header">
    <view class="header-title">æ±‰å­—èµ·å¦æ³•</view>
    <view class="help-btn" bindtap="onShowHelp">â“</view>
  </view>

  <!-- å…è´£å£°æ˜æç¤ºæ¡ -->
  <view class="disclaimer-banner" tt:if="{{showDisclaimer}}">
    <view class="disclaimer-content">
      <text class="disclaimer-text">{{disclaimerText}}</text>
      <view class="disclaimer-close" bindtap="onCloseDisclaimer">âœ•</view>
    </view>
  </view>

  <!-- èµ·å¦æŒ‡å¯¼ -->
  <view class="guidance">
    <view class="guidance-title">èµ·å¦æŒ‡å¯¼</view>
    <view class="guidance-content">
      <view class="guidance-item">1. é›†ä¸­ç²¾ç¥ï¼Œé»˜æƒ³æ‰€æ±‚æµ‹ä¹‹äº‹</view>
      <view class="guidance-item">2. ä»è·‘é©¬ç¯ä¸­é€‰æ‹©ä¸¤ä¸ªæ±‰å­—</view>
      <view class="guidance-item">3. ç³»ç»Ÿè‡ªåŠ¨æ˜¾ç¤ºç¹ä½“å­—å’Œç¬”ç”»æ•°</view>
      <view class="guidance-item">4. é€‰æ‹©å®Œæˆåè‡ªåŠ¨ç”Ÿæˆå¦è±¡ï¼Œå½“å‰ä»…ä½¿ç”¨å…¬å†æ—¶é—´</view>
      <view class="guidance-item">5. ç‚¹å‡»"ç»“æœè§£æ"æŸ¥çœ‹è¯¦ç»†è§£é‡Š</view>
    </view>
  </view>

  <!-- èµ·å¦æç¤º -->
  <view class="divination-subtitle">
    <view class="header-subtitle">è¯·é›†ä¸­æ„å¿µï¼Œé»˜æƒ³æ‰€æ±‚æµ‹ä¹‹äº‹</view>
  </view>

  <!-- æ±‰å­—é€‰æ‹©åŒºåŸŸ -->
  <view class="character-selection-area">
    <view class="selection-title">è¯·é€‰æ‹©ä¸¤ä¸ªæ±‰å­—</view>
    
    <!-- ç¬¬ä¸€ä¸ªæ±‰å­—é€‰æ‹© -->
    <view class="character-selection-group">
      <view class="selection-label">ç¬¬ä¸€ä¸ªæ±‰å­—</view>
      <view class="marquee-container">
        <view class="marquee-wrapper">
          <view class="marquee-content" style="--marquee-duration: {{marqueeSpeedA}}s;">
            <view 
              class="char-item {{charA === availableChars[(marqueeStartA + marqueeOffsetA + index) % availableChars.length] ? 'selected' : ''}}" 
              tt:for="{{marqueeIndexes}}" 
              tt:key="index"
              data-char="{{availableChars[(marqueeStartA + marqueeOffsetA + index) % availableChars.length]}}"
              data-field="charA"
              bindtap="onCharSelect"
            >
              {{availableChars[(marqueeStartA + marqueeOffsetA + index) % availableChars.length]}}
            </view>
          </view>
        </view>
      </view>
      
      <!-- é€Ÿåº¦æ§åˆ¶åŒºåŸŸ -->
      <view class="speed-control-area">
        <!-- å‡å·æŒ‰é’® -->
        <view class="speed-control-btn speed-decrease" bindtap="onDecreaseSpeedA">
          <text class="speed-btn-text">-</text>
        </view>
        
        <!-- é€Ÿåº¦æ˜¾ç¤º -->
        <view class="speed-display">
          <text class="speed-label">é€Ÿåº¦: {{marqueeRateA}}</text>
        </view>
        
        <!-- åŠ å·æŒ‰é’® -->
        <view class="speed-control-btn speed-increase" bindtap="onIncreaseSpeedA">
          <text class="speed-btn-text">+</text>
        </view>
      </view>
      
      <view class="selected-char-display" tt:if="{{charA}}">
        <text class="selected-char">{{charA}}</text>
        <view class="char-details">
          <text class="char-traditional">ç¹ä½“ï¼š{{charInfoA.traditional}}</text>
          <text class="char-strokes">ç¬”ç”»ï¼š{{strokesA}}</text>
        </view>
      </view>
      
      <!-- è°ƒè¯•ä¿¡æ¯ï¼šé™æ€æ˜¾ç¤ºå‰10ä¸ªæ±‰å­— -->
      <view class="debug-info" tt:if="{{availableChars.length > 0}}">
        <text class="debug-text">è°ƒè¯•ï¼šå‰10ä¸ªæ±‰å­— - {{availableChars.slice(0, 10).join(' ')}}</text>
        <text class="debug-text">åŠ¨ç”»æ—¶é—´ï¼šç¬¬ä¸€ä¸ª{{marqueeSpeedA}}ç§’ï¼Œç¬¬äºŒä¸ª{{marqueeSpeedB}}ç§’</text>
      </view>
    </view>

    <!-- ç¬¬äºŒä¸ªæ±‰å­—é€‰æ‹© -->
    <view class="character-selection-group">
      <view class="selection-label">ç¬¬äºŒä¸ªæ±‰å­—</view>
      <view class="marquee-container">
        <view class="marquee-wrapper">
          <view class="marquee-content" style="--marquee-duration: {{marqueeSpeedB}}s;">
            <view 
              class="char-item {{charB === availableChars[(marqueeStartB + marqueeOffsetB + index) % availableChars.length] ? 'selected' : ''}}" 
              tt:for="{{marqueeIndexes}}" 
              tt:key="index"
              data-char="{{availableChars[(marqueeStartB + marqueeOffsetB + index) % availableChars.length]}}"
              data-field="charB"
              bindtap="onCharSelect"
            >
              {{availableChars[(marqueeStartB + marqueeOffsetB + index) % availableChars.length]}}
            </view>
          </view>
        </view>
      </view>
      
      <!-- é€Ÿåº¦æ§åˆ¶åŒºåŸŸ -->
      <view class="speed-control-area">
        <!-- å‡å·æŒ‰é’® -->
        <view class="speed-control-btn speed-decrease" bindtap="onDecreaseSpeedB">
          <text class="speed-btn-text">-</text>
        </view>
        
        <!-- é€Ÿåº¦æ˜¾ç¤º -->
        <view class="speed-display">
          <text class="speed-label">é€Ÿåº¦: {{marqueeRateB}}</text>
        </view>
        
        <!-- åŠ å·æŒ‰é’® -->
        <view class="speed-control-btn speed-increase" bindtap="onIncreaseSpeedB">
          <text class="speed-btn-text">+</text>
        </view>
      </view>
      
      <view class="selected-char-display" tt:if="{{charB}}">
        <text class="selected-char">{{charB}}</text>
        <view class="char-details">
          <text class="char-traditional">ç¹ä½“ï¼š{{charInfoB.traditional}}</text>
          <text class="char-strokes">ç¬”ç”»ï¼š{{strokesB}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ—¶è¾°æ•°æ˜¾ç¤º -->
  <view class="time-display">
    <view class="time-label">æ—¶è¾°æ•°Tï¼ˆæ¯«ç§’%9ï¼‰ï¼š</view>
    <view class="time-value">{{timeT}}</view>
    <view class="refresh-btn" bindtap="onRefreshTimeT">åˆ·æ–°</view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <view class="action-btn divination-btn {{isDivinationDisabled ? 'disabled' : ''}}" bindtap="onGenerateGua">
      <view class="btn-icon">ğŸ“</view>
      <view class="btn-text"><view>ç”Ÿæˆ</view><view>å¦è±¡</view></view>
    </view>
    
    <!-- ä¿å­˜å¦è±¡æŒ‰é’®ï¼Œä¸€ç›´å­˜åœ¨ä½†æ ¹æ®çŠ¶æ€ç°åŒ– -->
    <view class="action-btn save-btn {{!result.upper ? 'disabled' : ''}} {{isCurrentGuaSaved ? 'saved' : ''}}" bindtap="onSaveCharacterDivinationToUserData">
      <view class="btn-icon">{{isCurrentGuaSaved ? 'âœ…' : 'ğŸ’¾'}}</view>
      <view class="btn-text"><view>ä¿å­˜</view><view>å¦è±¡</view></view>
    </view>
  </view>

  <!-- çˆ»ç»“æœæ˜¾ç¤ºåŒºåŸŸï¼ˆä¸æ‘‡é’±èµ·å¦é¡µé¢ä¸€è‡´ï¼‰ -->
  <view class="yao-display-area">
    <view class="yao-display-title">çˆ»è±¡ç»“æœï¼ˆä»åº•å‘ä¸Šï¼‰</view>
    <view class="yao-display-content">
      <view class="yao-item {{item.isEmpty ? 'empty' : ''}}" tt:for="{{yaoResults}}" tt:key="index">
        <view class="yao-number">{{item.number}}</view>
        <view class="yao-symbol {{item.result.type}}" tt:if="{{!item.isEmpty}}">{{item.result.symbol}}</view>
        <view class="yao-symbol empty" tt:if="{{item.isEmpty}}">â€”</view>
        <view class="yao-desc" tt:if="{{!item.isEmpty}}">{{item.result.desc}}</view>
        <view class="yao-desc empty" tt:if="{{item.isEmpty}}">å¾…ç”Ÿæˆ</view>
        <view class="coin-status" tt:if="{{!item.isEmpty && item.result.coinStatusText}}">
          <text class="coin-status-text">[{{item.result.coinStatusText}}]</text>
        </view>
      </view>
    </view>
  </view>

  <!-- é¡µé¢åº•éƒ¨æ“ä½œæŒ‰é’®åŒº -->
  <view class="footer-action-buttons">
    <view class="action-btn" bindtap="onViewBianGua">
      <view class="btn-icon">ğŸ“–</view>
      <view class="btn-text"><text>å˜å¦</text><text>åŸç†</text></view>
    </view>
    <view class="action-btn" bindtap="onNewDivination">
      <view class="btn-icon">ğŸ”„</view>
      <view class="btn-text"><text>é‡æ–°</text><text>èµ·å¦</text></view>
    </view>
    <view class="action-btn result-btn {{isDivinationDisabled ? 'disabled' : ''}}" bindtap="onResultAnalysis">
      <view class="btn-icon">ğŸ“Š</view>
      <view class="btn-text"><text>ç»“æœ</text><text>è§£æ</text></view>
    </view>
  </view>
</view> 