# 字符起卦功能说明

## 功能概述

字符起卦是微明易理研习录小程序的核心功能之一，允许用户通过输入两个汉字来生成卦象。该功能基于传统易学理论，结合现代技术实现，为用户提供便捷的起卦体验。

## 核心特性

### 1. 智能汉字处理
- **繁简转换**：自动将简体字转换为繁体字进行笔画数计算
- **笔画数计算**：内置300+常用汉字笔画数数据库
- **实时计算**：输入汉字后自动计算并显示笔画数
- **手动修正**：支持用户手动修改笔画数，确保准确性

### 2. 卦象生成算法
- **上卦计算**：第一个汉字笔画数 % 8
- **下卦计算**：第二个汉字笔画数 % 8  
- **动爻计算**：(第一个汉字笔画数 + 第二个汉字笔画数 + 当前时辰数) % 6
- **时辰数**：当前毫秒数 % 9，支持手动刷新

### 3. 用户界面设计
- **单色调设计**：采用灰色渐变背景，保持简洁美观
- **卡片式布局**：信息分层展示，层次清晰
- **响应式设计**：适配不同屏幕尺寸
- **实时反馈**：输入变化即时响应

## 技术实现

### 一体化中文处理工具 (`utils/chinese-processor.js`)

#### 主要功能
```javascript
// 获取汉字完整信息
const info = getChineseInfo('龙');
// {
//   original: '龙',
//   traditional: '龍', 
//   simplified: '龙',
//   strokes: 16,
//   isChinese: true
// }

// 繁简转换
const traditional = toTraditional('龙'); // '龍'
const simplified = toSimplified('龍'); // '龙'

// 笔画数计算
const strokes = getStrokeCount('龙'); // 16

// 批量处理
const results = processBatch('乾坤');
```

#### 技术特点
- **一体化设计**：繁简转换和笔画数计算集成在一个工具中
- **缓存机制**：内置缓存，提升重复查询性能
- **数据完整性**：300+常用汉字繁简对应关系和笔画数
- **性能优化**：内存映射查询，响应速度快
- **离线使用**：完全本地化，无需网络请求

#### 数据库覆盖
- **繁简映射**：300+常用汉字繁简对应关系
- **笔画数据**：基于繁体字的准确笔画数
- **分类覆盖**：数字、基础汉字、财富、情感、道德、方位、时间、八卦、动物、自然、植物、颜色、评价词、身体、家庭、职业、建筑、交通、食物、动词、形容词、副词等
- **估算机制**：未知汉字使用字符编码估算

### 页面结构

#### 输入区域
- 两个汉字输入框
- 实时笔画数显示
- 繁体字信息展示
- 笔画数编辑功能

#### 时辰数区域
- 当前时辰数显示
- 刷新按钮
- 自动更新机制

#### 结果展示区域
- 卦象符号显示
- 卦名展示
- 动爻标识
- 详细信息按钮

## 使用流程

### 1. 输入汉字
用户输入两个汉字，系统自动：
- 转换为繁体字
- 计算笔画数
- 显示汉字信息

### 2. 验证笔画数
- 查看自动计算的笔画数
- 如需要可手动修改
- 确保数据准确性

### 3. 生成卦象
- 系统自动计算卦象
- 显示上卦、下卦、动爻
- 提供卦名和基本信息

### 4. 查看详情
- 点击查看详细卦象信息
- 跳转到结果分析页面
- 获取完整解析

## 算法原理

### 八卦对应关系
```
1 → 乾卦 (☰)
2 → 兑卦 (☱) 
3 → 离卦 (☲)
4 → 震卦 (☳)
5 → 巽卦 (☴)
6 → 坎卦 (☵)
7 → 艮卦 (☶)
8 → 坤卦 (☷)
```

### 计算示例
```
输入汉字：龙(16画) + 虎(8画)
时辰数：5

上卦：16 % 8 = 0 → 8 → 坤卦
下卦：8 % 8 = 0 → 8 → 坤卦  
动爻：(16 + 8 + 5) % 6 = 29 % 6 = 5 → 第五爻

结果：坤为地卦，第五爻动
```

## 数据传递

### 全局数据格式
```javascript
{
  divinationType: 'character',
  charA: '龙',
  charB: '虎', 
  strokesA: 16,
  strokesB: 8,
  timeT: 5,
  result: {
    upper: 8, // 坤卦
    lower: 8, // 坤卦
    moving: 5, // 第五爻
    guaName: '坤为地'
  },
  yaoResults: [/* 爻结果数组 */]
}
```

### 结果分析页面集成
- 支持字符起卦数据的特殊处理
- 显示汉字信息和计算过程
- 提供传统与现代结合的解析

## 界面设计

### 设计原则
- **简洁性**：去除冗余元素，突出核心功能
- **一致性**：与摇钱起卦页面保持设计统一
- **可用性**：操作流程清晰，反馈及时
- **美观性**：灰色渐变背景，卡片式布局

### 色彩方案
- **主色调**：灰色系 (#696969, #f5f5f5, #e8e8e8)
- **强调色**：深灰色 (#424242)
- **背景色**：渐变灰色
- **文字色**：深灰色，确保可读性

### 布局结构
```
┌─────────────────────────┐
│        标题区域          │
├─────────────────────────┤
│      汉字输入区域        │
│  [汉字A] [汉字B]        │
│  笔画数A  笔画数B        │
│  繁体A    繁体B          │
├─────────────────────────┤
│      时辰数区域          │
│  当前时辰数: X [刷新]    │
├─────────────────────────┤
│      卦象结果区域        │
│  ☰ ☷ 乾为天             │
│  [生成卦象] [查看详情]   │
├─────────────────────────┤
│      帮助说明区域        │
│  [使用说明] [算法原理]   │
└─────────────────────────┘
```

## 扩展功能

### 1. 历史记录
- 保存用户起卦历史
- 支持历史记录查看
- 提供重复起卦功能

### 2. 批量处理
- 支持多个汉字组合
- 批量生成卦象
- 结果对比分析

### 3. 高级设置
- 自定义算法参数
- 多种起卦模式
- 个性化配置

### 4. 数据导出
- 起卦结果导出
- 数据备份功能
- 分享功能

## 技术优势

### 1. 性能优化
- 内存映射查询，响应速度快
- 本地数据库，无需网络请求
- 缓存机制，提升重复查询性能
- 轻量级实现，适合小程序环境

### 2. 数据准确性
- 基于权威汉字数据库
- 支持用户验证和修正
- 多重验证机制
- 数据完整性检查

### 3. 用户体验
- 实时反馈，操作流畅
- 界面简洁，易于使用
- 功能完整，满足需求
- 离线使用，启动快速

### 4. 可维护性
- 模块化设计，易于扩展
- 清晰的代码结构
- 完善的文档说明
- 统一的错误处理

## 相关文件

- `pages/character-divination/` - 页面文件
- `utils/chinese-processor.js` - 一体化中文处理工具
- `data/sixtyFourGua.js` - 64卦数据
- `utils/solution-comparison.md` - 方案对比文档 